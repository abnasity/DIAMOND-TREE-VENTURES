{% extends 'layouts/base.html' %}
{% block content %}
<h2 class="mt-4">Order #{{ order.id }}</h2>

<p><strong>Customer:</strong> {{ order.customer.full_name }}</p>

<p><strong>Status:</strong>
    {% if order.status == 'pending' %}
        <span class="badge bg-warning text-dark">Pending</span>
    {% elif order.status == 'awaiting_approval' %}
        <span class="badge bg-info text-dark">Awaiting Approval</span>
    {% elif order.status == 'approved' %}
        <span class="badge bg-success">Approved</span>
    {% elif order.status == 'cancelled' %}
        <span class="badge bg-danger">Cancelled</span>
    {% elif order.status == 'rejected' %}
        <span class="badge bg-dark">Rejected</span> 
    {% endif %}
</p>

<p><strong>Delivery Address:</strong> {{ order.delivery_address }}</p>
<p><strong>Created At:</strong> {{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

{% if order.status == 'approved' %}
    <p><strong>Approved By:</strong> {{ order.approved_by.username }}</p>
    <p><strong>Approved At:</strong> {{ order.approved_at.strftime('%Y-%m-%d %H:%M') }}</p>
{% endif %}

<h4 class="mt-4">Items:</h4>
<table class="table table-bordered">
    <thead>
        <tr>
            <th>IMEI</th>
            <th>Purchase Price</th>
            <th>Order Price</th>
        </tr>
    </thead>
    <tbody>
        {% for item in order.items %}
            <tr>
                <td>{{ item.device.imei }}</td>
                <td>Ksh {{ item.device.purchase_price }}</td>
                <td>Ksh {{ item.unit_price }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

{% if order.status in ['pending', 'awaiting_approval'] %}
    <form method="POST" action="{{ url_for('auth.mark_awaiting_approval', order_id=order.id) }}" class="mt-3">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <button type="submit" class="btn btn-success">Mark as Awaiting Approval</button>
    </form>
{% endif %}

<a href="{{ url_for('auth.notifications') }}" class="btn btn-secondary mt-3">Back to Notifications</a>
{% endblock %}
